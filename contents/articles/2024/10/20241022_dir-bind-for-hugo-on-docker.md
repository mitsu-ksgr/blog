---
title: "Hugo on Docker: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åˆ¥ç®¡ç†ã™ã‚‹ã¨ãã®ãƒã‚¤ãƒ³ãƒ‰ã«ã¤ã„ã¦ã®ãƒ¡ãƒ¢"
created: 2024-10-22T23:21:41.151Z
categories: ["tech", "Hugo"]
tags: ["tech", "Hugo", "Docker"]
---

ã‚¿ã‚¤ãƒˆãƒ«ãŒæ„å‘³ä¸æ˜ã™ãã‚‹ã€ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä»˜ã‘ã‚‹ã®é›£ã—ã„â€¦â€¦ã€‚


### å‰æ

- Docker ä¸Šã§ Hugo ã‚’å‹•ã‹ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆçš„ãªã‚¢ãƒ¬ï¼‰
- Hugo image ã¯ [ghcr.io/gohugoio/hugo](https://github.com/gohugoio/hugo/pkgs/container/hugo) ãƒ™ãƒ¼ã‚¹ã«ã—ãŸã‚‚ã®ã‚’æƒ³å®š
- Markdown ã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ Hugo ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯åˆ¥ã§ç®¡ç†ã—ã¦ã„ã‚‹
    - content ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã® markdown ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã ã‘åˆ¥ã§ç®¡ç†ã—ã¦ã‚‹æ§‹æˆ

Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã§æ§‹æˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã€
Hugo ã‚³ãƒ³ãƒ†ãƒŠã«ãƒã‚¤ãƒ³ãƒ‰ã—ã¦ã€
Hugo ä¸Šã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã€ã¿ãŸã„ãªæ„Ÿã˜


### æ™®é€šã¯
ãã®ã¾ã¾ -v ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚Œã°è‰¯ãã¦ã€ç‰¹ã«æ„è­˜ã™ã‚‹å¿…è¦ã¯ãªã„ã€‚
ãªã‚“ã®å•é¡Œã‚‚ãªã„ã€‚

```sh
$ docker run --rm -it -p 1313:1313 -v ./docs:/project/app/content/docs my-hugo:latest
```

â€» ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¾ã‚ã‚Šã§ã‚¢ãƒ¬ã‚³ãƒ¬ã—ã¦ãŸã¨ãã«å‡ºãŸè©±é¡Œã ã‹ã‚‰ `docs` ã¨ã„ã†åå‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¾‹ã«ã—ã¦ã‚‹


### æœ¬é¡Œ

ä½•ã®å•é¡Œã‚‚ãªã„ã‚“ã ã‘ã©ã€
æ¯å› `-v ./docs:/project/app/content/docs` ã—ãŸããªã„ã¨æ€ã£ã¦ã—ã¾ã£ãŸã€‚

`-v ./pages:/pages` ã¿ãŸã„ã«ã—ãŸã„ã€‚

ã“ã‚ŒãŒæ„å¤–ã¨é¢å€’ã ã£ãŸã®ã§ã€ã„ã‚ã„ã‚è©¦ã—ãŸã¨ãã®è¨˜éŒ²ã€‚


#### 1. ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯

`docker-entrypoint.sh` ã‚’ç”¨æ„ã—ã¦ã€èµ·å‹•æ™‚ã« `/docs` ã¨ `/project/app/content/docs` ã‚’ç¹‹ã’ã‚‹ä½œæˆ¦ã€‚

```sh
# docker-entrypoint.sh

ln -s /docs /project/app/content/docs

hugo server -D --bind 0.0.0.0
```

```sh
$ docker run --rm -it -p 1313:1313 -v ./docs:/docs my-hugo:latest
```

ã“ã‚Œã§ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯ã§ãã‚‹ãŒã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®æ›´æ–°ãŒä¸Šæ‰‹ãå‹•ä½œã—ãªã„ã€‚

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ãŸã‚‰ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã—ãªã„ã¨æ›´æ–°ãŒåæ˜ ã•ã‚Œãªã‹ã£ãŸã€‚

Hugo ã¯ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®æ¤œå‡ºã« `inotify` ã‚’ä½¿ã£ã¦ã„ã¦ã€
`inotify` ã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯å…ˆã‚’ç›£è¦–ã—ãªã„ã‚‰ã—ã„ã€‚



#### 2. mount ã™ã‚‹

ãªã‚‰ mount ã™ã‚Œã°ã„ã‘ã‚‹ã‹ã€ã¨ã„ã†ã“ã¨ã§ `docker-entrypoint.sh` ã® `ln -s` ã‚’ `mount --bind` ã«ã—ã¦ã¿ãŸã€‚

```sh
# docker-entrypoint.sh

mount --bind /docs /project/app/content/docs

hugo server -D --bind 0.0.0.0
```

ã“ã‚Œã§ docker run ã‚’ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚

```
mount: permission denied (are you root?)
```

`USER root` ã‚’ã—ã¦ã„ã¦ã‚‚åŒã˜ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
ã©ã†ã‚‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŒå£«ã®ãƒã‚¦ãƒ³ãƒˆã ã¨ã—ã¦ã‚‚ã€`mount` ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚

`docker run` æ™‚ã« `--privileged` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ãŸã¨ã“ã‚ã€æœ›ã‚€å‹•ä½œã‚’ã—ã¦ãã‚ŒãŸã€‚

ã§ã‚‚ã“ã‚Œã ã‘ã®ãŸã‚ã«ç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠãªã‚“ã¦ä½¿ã„ãŸããªã„ã—ã€
æ¯å› `--privileged` ã‚’å…¥åŠ›ã™ã‚‹ã®ã¯é¢å€’ãã•ã„ã€‚

`-v ./docs:/docs --privileged` ã¨ `-v ./docs:/project/app/content/docs`
ã ã¨ã‚ã‚“ã¾ã‚Šã‚¿ã‚¤ãƒ—æ•°ã«é•ã„ã‚‚ãªã„ã—â€¦â€¦ã€‚


ä¸€å¿œ privileged ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚æ›¸ã„ã¦ãŸã®ã§ã€
ã“ã“ã§ä¾›é¤Šã—ã¦ãŠã ğŸ™

```sh
# docker-compose.yml
check_privileged() {
    local test_dir=$(mktemp -d)
    if mount --bind "${test_dir}" "${test_dir}" &>/dev/null; then
        # OK!
        umount "${test_dir}"
        rmdir "${test_dir}"
    else
        cat <<__EOS__ 1>&2
Error: Please run the container with the '--privileged' otion.

$ docker run --rm -it --privileged -p 1313:1313 -v ./your-docs:/docs hextra-dock:latest
__EOS__
        exit 1
    fi
}

main() {
    check_privileged

    mount --bind /docs /project/app/content/docs

    # å®Ÿéš›ã¯ã€ä»–ã®ä¾‹ã®å ´åˆã‚‚ 'USER root' ã®ã¨ãã¯ runuser ã§ hugo ã‚’èµ·å‹•ã—ã¦ã‚‹
    runuser -u hugo -- \
        hugo server -D --bind 0.0.0.0
}

main $@
exit 0
```



#### 3. rsync ã—ç¶šã‘ã‚‹

æœ€çµ‚çš„ã«ãŸã©ã‚Šç€ã„ãŸã®ãŒ `rsync` ã™ã‚‹æ–¹æ³•ã€‚
Chat-GPT ã•ã‚“ã«ã€Œãªã‚“ã‹ã„ã„æ–¹æ³•ãªã„ï¼Ÿã€ã£ã¦èã„ã¦ãŸã‚‰æ•™ãˆã¦ãã‚ŒãŸã€
AIä¸‡æ­³ã€ã¼ããªã©å¿…è¦ãªã‹ã£ãŸã€‚

```sh
# docker-entrypoint.sh

# åˆå›åŒæœŸ
rsync -av --delete /docs/ /project/app/content/docs/

# ãƒãƒƒã‚¯ã‚°ãƒ©ãƒ³ãƒ‰ã§å®šæœŸçš„ã«åŒæœŸ
while true; do
    rsync -av --delete /docs/ /project/app/content/docs/
    sleep 5 # ãã†ã—ãŸã‘ã‚Œã°ï¼‘ç§’ã§ã‚‚ã„ã„
done &

hugo server -D --bind 0.0.0.0
```

ã™ã“ã—ã‚®ãƒ§ãƒƒã¨ã™ã‚‹ã‘ã©ã€ã†ã¾ãå‹•ãã€‚

ã“ã‚Œã§æ™´ã‚Œã¦

```sh
$ docker run --rm -it -p 1313:1313 -v ./docs:/docs my-hugo:latest
```

ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’é–‹å§‹ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚‚ãƒªã‚¢ãƒ«ã‚¿â€¦â€¦5ç§’ãŠãã«åæ˜ ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚


##### ãŠã‚ã‚Š
æœ€åˆã«ã‚„ã‚ŠãŸã‹ã£ãŸã€

- `-v ./docs:/docs` ã§ãƒã‚¤ãƒ³ãƒ‰ã—ãŸã„
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¤‰æ›´ã‚’åæ˜ ã—ãŸã„

ãŒé”æˆã§ããŸã‹ã‚‰æº€è¶³ã§ã¯ã‚ã‚‹ã‘ã©ã€æ€ã£ãŸã‚ˆã‚Šå¤§ã’ã•ãªæ„Ÿã˜ã«ãªã£ã¦ã—ã¾ã£ãŸã€‚

æ™®é€šã«æˆ‘æ…¢ã—ã¦ãƒã‚¤ãƒ³ãƒ‰ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚

ã‚ã¨ LLM ä¾¿åˆ©ã€ã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã€‚


